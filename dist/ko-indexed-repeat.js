/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function J(q){var A,x,y;A=function(){function a(a){this.length=function(){return a.length};this.get=function(m){return a[m]}}function e(a){this.length=function(){return a.length()};this.get=function(m){return a.get(m)}}function f(a){this.length=function(){return a.length};this.get=function(m){return a.get(m)}}return{m:function(k){if(Array.isArray(k))k=a;else a:switch(typeof k.length){case "function":k=e;break a;case "number":k=f;break a;default:throw Error("Unsupported type: The `forEach` value must be an array or a list with a `length` property or method.");
}return k}}}();x=function(a){function e(a){if("function"===typeof a)return a;if("string"===typeof a)return function(d){return d[a]};throw Error("A repeat-binding must specify and indexedBy of type string (property name) or function (custom selector).");}function f(e){a.cleanNode(e);window.setTimeout(function(){a.cleanNode(e)},1);var d=e.cloneNode(!0);d.removeAttribute("data-bind");"string"===typeof e.getAttribute("data-repeat-bind")&&(d.setAttribute("data-bind",e.getAttribute("data-repeat-bind")),
d.removeAttribute("data-repeat-bind"));return d}var k=window.document;return function(a,d){var b=a.getAttribute("data-bind");this.k=e(d.indexedBy);this.o=d.as||"$item";this.l=d.at||"$index";this.h=!1!==d.allowElementRecycling;this.e=!0===d.allowDeviation;this.p=d.onDeviation||function(){};this.q=d.onSynchronization||function(){};this.parent=a.parentNode;this.c=k.createComment("[repeat("+b+")");this.d=k.createComment("repeat("+b+")]");this.n=f(a);this.j=this.c}}(q);y=function(){function a(){this.b=
0;this.a={}}a.prototype={add:function(a,f){if(Object.prototype.hasOwnProperty.call(this.a,a))throw Error("Key `"+a+"` is already taken.");++this.b;this.a[a]=f},get:function(a){return this.a[a]},remove:function(a){if(!Object.prototype.hasOwnProperty.call(this.a,a))throw Error("No entry for key  `"+a+"` present.");delete this.a[a];--this.b},clear:function(){this.a={};this.b=0},get size(){return this.b},forEach:function(a){for(var f in this.a)Object.prototype.hasOwnProperty.call(this.a,f)&&a(f,this.a[f])}};
return a}();return function(a){return a}(function(a,e,f,k){return a.bindingHandlers.indexedRepeat={init:function(m,d,b,E,F){d=d();b=new f(m,d);E=b.j;b.parent.replaceChild(b.d,m);b.parent.insertBefore(b.c,b.d);var u=new k(b,F);b.e&&a.utils.domNodeDisposal.addDisposeCallback(E,function(){u.g()});var z=d.forEach,q=e.m(z());return{controlsDescendantBindings:!0,subscribable:a.computed(function(){var b=new q(z());a.ignoreDependencies(u.r,u,[b])},null,{disposeWhenNodeIsRemoved:E})}}}}(q,A,x,function(a,e){function f(a,
d){this.element=a;this.i=d}function k(a,d,f,e){this.index=a;this.item=d;this.id=f;this.f=e}var m=window.requestAnimationFrame.bind(window),d=window.cancelAnimationFrame.bind(window);return function(b,q){function F(){u((new Date).getTime()+40)}function u(a){for(;z();)if(++r,(new Date).getTime()>a){N();B=m(F);return}x()}function z(){if(r<v.length()){var c=r,d=v.get(r),e=c?C(v.get(c-1)):null,g=C(d),h=w.get(g);if(h)if(h.element.style.display="",h.i[G](c),c=n.get(g))n.remove(g),H.insertBefore(c,p.nextSibling),
p=c;else{for(;h.element!==p.nextSibling;)K(p.nextSibling);p=h.element}else t.push(new k(c,d,g,e))}else if(l)if(t.length)b.h&&l.length?(g=l.pop(),h=t.shift(),g.style.display="",L(g,h.f),c=a.contextFor(g),c[D](h.item),c[G](h.index),w.add(h.id,new f(g,c))):(g=t.shift(),h=O.cloneNode(!0),c={},c[G]=a.observable(g.index),c[D]=a.observable(g.item),c=q.extend(c),w.add(g.id,new f(h,c)),a.applyBindings(c,h),L(h,g.f),++I);else{for(;l.length;)a.removeNode(l.pop());return}else A();return!0}function A(){l=[];for(var a=
v.length()-t.length,a=I-n.size-a;0<a;--a)K(p.nextSibling);n.forEach(function(a,c){w.remove(a);l.push(c)});n.clear()}function x(){for(var c=0;c<l.length;++c)a.removeNode(l[c]);I=v.length();y();P()}function y(){r=0;l=n=t=p=null}function L(a,d){var b=(d?w.get(d).element:Q).nextSibling;H.insertBefore(a,b)}function K(c){n.add(C(a.contextFor(c)[D]()),c);c.style.display="none";H.insertBefore(c,R)}function M(){if(B){d(B);B=null;for(var c=0;null!==l&&c<l.length;++c){var b=l[c];w.add(C(a.contextFor(b)[D]()),
new f(b,a.contextFor(b)))}y()}}var C=b.k,D=b.o,G=b.l,S=b.e,N=b.p,P=b.q,H=b.parent,Q=b.c,R=b.d,O=b.n,v=null,w=new e,I=0,r=0,p=null,B=null,t=null,n=null,l=null;this.r=function(a){M();r=0;p=b.c;t=[];n=new e;v=a;if(S)u((new Date).getTime()+15);else{for(;z();)++r;x()}};this.g=M}}(q,y)))}"function"===typeof define&&define.amd?define(["knockout"],J):window["ko-indexed-repeat"]=J(window.ko);