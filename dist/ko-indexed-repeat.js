/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function K(q){var B,x,y;B=function(){function a(b){this.length=function(){return b.length};this.get=function(e){return b[e]}}function m(b){this.length=function(){return b.length()};this.get=function(e){return b.get(e)}}function h(b){this.length=function(){return b.length};this.get=function(e){return b.get(e)}}return{m:function(b){if(Array.isArray(b))b=a;else a:switch(typeof b.length){case "function":b=m;break a;case "number":b=h;break a;default:throw Error("Unsupported type: The `forEach` value must be an array or a list with a `length` property or method.");
}return b}}}();x=function(a){function m(e){if("function"===typeof e)return e;if("string"===typeof e)return function(b){return""+b[e]};throw Error("A repeat-binding must specify and indexedBy of type string (property name) or function (custom selector).");}function h(b){a.cleanNode(b);window.setTimeout(function(){a.cleanNode(b)},1);var c=b.cloneNode(!0);c.removeAttribute("data-bind");"string"===typeof b.getAttribute("data-repeat-bind")&&(c.setAttribute("data-bind",b.getAttribute("data-repeat-bind")),
c.removeAttribute("data-repeat-bind"));return c}var b=window.document;return function(a,c){var d=a.getAttribute("data-bind");this.k=m(c.indexedBy);this.o=c.as||"$item";this.l=c.at||"$index";this.h=!1!==c.allowElementRecycling;this.r=c.beforeElementRecycling||function(){};this.q=c.afterElementRecycled||function(){};this.e=!0===c.allowDeviation;this.p=c.onDeviation||function(){};this.s=c.onSynchronization||function(){};this.parent=a.parentNode;this.c=b.createComment("[repeat("+d+")");this.d=b.createComment("repeat("+
d+")]");this.n=h(a);this.j=this.c}}(q);y=function(){function a(){this.b=0;this.a={}}a.prototype={add:function(a,h){if(Object.prototype.hasOwnProperty.call(this.a,a))throw Error("Key `"+a+"` is already taken.");++this.b;this.a[a]=h},get:function(a){return Object.prototype.hasOwnProperty.call(this.a,a)?this.a[a]:null},remove:function(a){if(!Object.prototype.hasOwnProperty.call(this.a,a))throw Error("No entry for key  `"+a+"` present.");delete this.a[a];--this.b},clear:function(){this.a={};this.b=0},
get size(){return this.b},forEach:function(a){for(var h=Object.keys(this.a),b=0,e=h.length;b<e;b++){var c=h[b];a(c,this.a[c])}}};return a}();return function(a){return a}(function(a,m,h,b){return a.bindingHandlers.indexedRepeat={init:function(e,c,d,F,G){c=c();d=new h(e,c);F=d.j;d.parent.replaceChild(d.d,e);d.parent.insertBefore(d.c,d.d);var v=new b(d,G);d.e&&a.utils.domNodeDisposal.addDisposeCallback(F,function(){v.g()});var z=c.forEach,q=m.m(z());return{controlsDescendantBindings:!0,subscribable:a.computed(function(){var b=
new q(z());a.ignoreDependencies(v.t,v,[b])},null,{disposeWhenNodeIsRemoved:F})}}}}(q,B,x,function(a,m){function h(a,b){this.element=a;this.i=b}function b(a,b,c,e){this.index=a;this.item=b;this.id=c;this.f=e}var e=window.requestAnimationFrame.bind(window),c=window.cancelAnimationFrame.bind(window);return function(d,q){function G(){A=0;v((new Date).getTime()+40)}function v(a){for(;z();)if(++r,(new Date).getTime()>a){N();A=e(G);return}C=t.length();H();L()}function z(){if(r<t.length()){var f=r,c=t.get(r),
e=f?D(t.get(f-1)):null,g=D(c),k=w.get(g);if(k)if(k.element.style.display="",k.i[I](f),f=n.get(g))n.remove(g),J.insertBefore(f,p.nextSibling),p=f;else{for(;k.element!==p.nextSibling;)y(p.nextSibling);p=k.element}else u.push(new b(f,c,g,e))}else if(l)if(u.length)d.h&&l.length?(g=l.pop(),k=u.shift(),f=a.contextFor(g),d.r(g,f),g.style.display="",x(g,k.f),f[E](k.item),f[I](k.index),d.q(g,f),w.add(k.id,new h(g,f))):(g=u.shift(),k=O.cloneNode(!0),f={},f[I]=a.observable(g.index),f[E]=a.observable(g.item),
f=q.extend(f),w.add(g.id,new h(k,f)),a.applyBindings(f,k),x(k,g.f),++C);else{for(;l.length;)a.removeNode(l.pop());return 0}else B();return!0}function B(){l=[];for(var a=t.length()-u.length,a=C-n.size-a;0<a;--a)y(p.nextSibling);n.forEach(function(a,b){w.remove(a);l.push(b)});n.clear()}function H(){r=0;l=n=u=p=null}function x(a,b){var c=(b?w.get(b).element:P).nextSibling;J.insertBefore(a,c)}function y(b){n.add(D(a.contextFor(b)[E]()),b);b.style.display="none";J.insertBefore(b,Q)}function M(){if(A){c(A);
for(var b=A=0;null!==l&&b<l.length;++b){var d=l[b];w.add(D(a.contextFor(d)[E]()),new h(d,a.contextFor(d)))}H()}}var D=d.k,E=d.o,I=d.l,R=d.e,N=d.p,L=d.s,J=d.parent,P=d.c,Q=d.d,O=d.n,t=null,w=new m,C=0,r=0,p=null,A=0,u=null,n=null,l=null;this.t=function(a){M();r=0;p=d.c;u=[];n=new m;t=a;if(R)v((new Date).getTime()+15);else{for(;z();)++r;C=t.length();H();L()}};this.g=M}}(q,y)))}"function"===typeof define&&define.amd?define(["knockout"],K):window["ko-indexed-repeat"]=K(window.ko);