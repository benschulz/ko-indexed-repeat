/*
 Copyright (c) 2015, Ben Schulz
 License: BSD 3-clause (http://opensource.org/licenses/BSD-3-Clause)
*/
function J(q){var A,w,x;A=function(){function a(a){this.length=function(){return a.length};this.get=function(m){return a[m]}}function e(a){this.length=function(){return a.length()};this.get=function(m){return a.get(m)}}function f(a){this.length=function(){return a.length};this.get=function(m){return a.get(m)}}return{m:function(k){if(Array.isArray(k))k=a;else a:switch(typeof k.length){case "function":k=e;break a;case "number":k=f;break a;default:throw Error("Unsupported type: The `forEach` value must be an array or a list with a `length` property or method.");
}return k}}}();w=function(a){function e(a){if("function"===typeof a)return a;if("string"===typeof a)return function(d){return d[a]};throw Error("A repeat-binding must specify and indexedBy of type string (property name) or function (custom selector).");}function f(e){a.cleanNode(e);window.setTimeout(function(){a.cleanNode(e)},1);var d=e.cloneNode(!0);d.removeAttribute("data-bind");"string"===typeof e.getAttribute("data-repeat-bind")&&(d.setAttribute("data-bind",e.getAttribute("data-repeat-bind")),
d.removeAttribute("data-repeat-bind"));return d}var k=window.document;return function(a,d){var c=a.getAttribute("data-bind");this.k=e(d.indexedBy);this.o=d.as||"$item";this.l=d.at||"$index";this.h=!1!==d.allowElementRecycling;this.e=!0===d.allowDeviation;this.p=d.onDeviation||function(){};this.q=d.onSynchronization||function(){};this.parent=a.parentNode;this.c=k.createComment("[repeat("+c+")");this.d=k.createComment("repeat("+c+")]");this.n=f(a);this.j=this.c}}(q);x=function(){function a(){this.b=
0;this.a={}}a.prototype={add:function(a,f){if(Object.prototype.hasOwnProperty.call(this.a,a))throw Error("Key `"+a+"` is already taken.");++this.b;this.a[a]=f},get:function(a){return this.a[a]},remove:function(a){if(!Object.prototype.hasOwnProperty.call(this.a,a))throw Error("No entry for key  `"+a+"` present.");delete this.a[a];--this.b},clear:function(){this.a={};this.b=0},get size(){return this.b},forEach:function(a){for(var f in this.a)Object.prototype.hasOwnProperty.call(this.a,f)&&a(f,this.a[f])}};
return a}();return function(a){return a}(function(a,e,f,k){return a.bindingHandlers.indexedRepeat={init:function(m,d,c,E,F){d=d();c=new f(m,d);E=c.j;c.parent.replaceChild(c.d,m);c.parent.insertBefore(c.c,c.d);var y=new k(c,F);c.e&&a.utils.domNodeDisposal.addDisposeCallback(E,function(){y.g()});var z=d.forEach,q=e.m(z());return{controlsDescendantBindings:!0,subscribable:a.computed(function(){var a=new q(z());y.r(a)},null,{disposeWhenNodeIsRemoved:E})}}}}(q,A,w,function(a,e){function f(a,d){this.element=
a;this.i=d}function k(a,d,f,e){this.index=a;this.item=d;this.id=f;this.f=e}var m=window.requestAnimationFrame,d=window.cancelAnimationFrame;return function(c,q){function F(){y((new Date).getTime()+40)}function y(a){for(;z();)if(++r,(new Date).getTime()>a){N();B=m(F);return}w()}function z(){if(r<u.length()){var b=r,d=u.get(r),e=b?C(u.get(b-1)):null,g=C(d),h=v.get(g);if(h)if(h.element.style.display="",h.i[G](b),b=n.get(g))n.remove(g),H.insertBefore(b,p.nextSibling),p=b;else{for(;h.element!==p.nextSibling;)K(p.nextSibling);
p=h.element}else t.push(new k(b,d,g,e))}else if(l)if(t.length)c.h&&l.length?(g=l.pop(),h=t.shift(),g.style.display="",L(g,h.f),b=a.contextFor(g),b[D](h.item),b[G](h.index),v.add(h.id,new f(g,b))):(g=t.shift(),h=O.cloneNode(!0),b={},b[G]=a.observable(g.index),b[D]=a.observable(g.item),b=q.extend(b),v.add(g.id,new f(h,b)),a.applyBindings(b,h),L(h,g.f),++I);else return!1;else A();return!0}function A(){l=[];for(var a=u.length()-t.length,a=I-n.size-a;0<a;--a)K(p.nextSibling);n.forEach(function(a,b){v.remove(a);
l.push(b)});n.clear()}function w(){for(var b=0;b<l.length;++b)a.removeNode(l[b]);I=u.length();M();P()}function x(){d(B);B=null;for(var b=0;null!==l&&b<l.length;++b){var c=l[b];v.add(C(a.contextFor(c)[D]()),new f(c,a.contextFor(c)))}M()}function M(){r=0;l=n=t=p=null}function L(a,c){var d=(c?v.get(c).element:Q).nextSibling;H.insertBefore(a,d)}function K(b){n.add(C(a.contextFor(b)[D]()),b);b.style.display="none";H.insertBefore(b,R)}var C=c.k,D=c.o,G=c.l,S=c.e,N=c.p,P=c.q,H=c.parent,Q=c.c,R=c.d,O=c.n,
u=null,v=new e,I=0,r=0,p=null,B=null,t=null,n=null,l=null;this.r=function(a){B&&x();r=0;p=c.c;t=[];n=new e;u=a;if(S)y((new Date).getTime()+15);else{for(;z();)++r;w()}};this.g=x}}(q,x)))}"function"===typeof define&&define.amd?define(["knockout"],J):window["ko-indexed-repeat"]=J(window.ko);
